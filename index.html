<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz Educacional Interativo</title>
  <meta name="description" content="Quiz educacional com interface amig√°vel, QR Code otimizado e an√°lise detalhada de resultados para professores." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'><text y='1em' font-size='96'>üéì</text></svg>">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      /* Cores Base */
      --bg-primary: #f8fafc;
      --bg-secondary: #f1f5f9;
      --bg-card: #ffffff;
      
      /* Cores de Texto */
      --text-primary: #334155;
      --text-secondary: #64748b;
      --text-muted: #94a3b8;
      
      /* Cores de Destaque */
      --color-primary: #3b82f6;
      --color-primary-light: #bfdbfe;
      --color-secondary: #10b981;
      --color-secondary-light: #bbf7d0;
      
      /* Cores de Estado */
      --color-success: #16a34a;
      --color-success-light: #dcfce7;
      --color-warning: #d97706;
      --color-warning-light: #fef3c7;
      --color-error: #dc2626;
      --color-error-light: #fecaca;
      
      /* Cores Especiais */
      --color-purple: #8b5cf6;
      --color-purple-light: #e9d5ff;
      --color-pink-light: #fce7f3;
      --color-orange-light: #fed7aa;
      
      /* Bordas e Sombras */
      --border-color: #e2e8f0;
      --border-focus: #3b82f6;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      
      /* Gradientes */
      --gradient-primary: linear-gradient(135deg, #bfdbfe 0%, #e9d5ff 100%);
      --gradient-success: linear-gradient(135deg, #bbf7d0 0%, #dcfce7 100%);
      --gradient-warning: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      padding: 1rem;
      min-height: 100vh;
    }

    .app {
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    /* Cards e Containers */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: var(--shadow-md);
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    .card-gradient {
      background: var(--gradient-primary);
      border: none;
    }

    /* Typography */
    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--color-primary), var(--color-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    h2 {
      font-size: 1.875rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 1rem;
    }

    h3 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.75rem;
    }

    .text-muted {
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    .text-secondary {
      color: var(--text-secondary);
    }

    /* Layout */
    .grid {
      display: grid;
      gap: 1rem;
    }

    .grid-2 {
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }

    .grid-3 {
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }

    .flex {
      display: flex;
      gap: 1rem;
    }

    .flex-center {
      align-items: center;
      justify-content: center;
    }

    .flex-between {
      align-items: center;
      justify-content: space-between;
    }

    .flex-wrap {
      flex-wrap: wrap;
    }

    /* Bot√µes */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 12px;
      font-weight: 500;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      min-height: 44px;
      position: relative;
      overflow: hidden;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-primary {
      background: var(--color-primary);
      color: white;
    }

    .btn-primary:hover {
      background: #2563eb;
    }

    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: #e2e8f0;
    }

    .btn-success {
      background: var(--color-success);
      color: white;
    }

    .btn-success:hover {
      background: #15803d;
    }

    .btn-warning {
      background: var(--color-warning);
      color: white;
    }

    .btn-warning:hover {
      background: #b45309;
    }

    .btn-error {
      background: var(--color-error);
      color: white;
    }

    .btn-error:hover {
      background: #b91c1c;
    }

    .btn-lg {
      padding: 1rem 2rem;
      font-size: 1rem;
      min-height: 52px;
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      min-height: 36px;
    }

    /* Inputs */
    .input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--bg-card);
      color: var(--text-primary);
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }

    .input:focus {
      outline: none;
      border-color: var(--border-focus);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .input-group {
      margin-bottom: 1rem;
    }

    .label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-primary);
    }

    /* Pills e Badges */
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--color-primary-light);
      color: var(--color-primary);
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 500;
      border: 1px solid rgba(59, 130, 246, 0.2);
    }

    .pill-success {
      background: var(--color-success-light);
      color: var(--color-success);
      border-color: rgba(22, 163, 74, 0.2);
    }

    .pill-warning {
      background: var(--color-warning-light);
      color: var(--color-warning);
      border-color: rgba(217, 119, 6, 0.2);
    }

    /* Progress Bar */
    .progress {
      width: 100%;
      height: 8px;
      background: var(--bg-secondary);
      border-radius: 999px;
      overflow: hidden;
      position: relative;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--color-primary), var(--color-purple));
      border-radius: 999px;
      transition: width 0.3s ease;
      position: relative;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* QR Code Container */
    .qr-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1.5rem;
      background: var(--gradient-primary);
      border-radius: 16px;
      border: 2px dashed var(--color-primary);
    }

    .qr-code {
      background: white;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: var(--shadow-md);
      min-height: 200px;
      min-width: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Quiz Options */
    .quiz-option {
      padding: 1rem 1.5rem;
      border: 2px solid var(--border-color);
      border-radius: 12px;
      background: var(--bg-card);
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 0.75rem;
      position: relative;
      overflow: hidden;
    }

    .quiz-option:hover {
      border-color: var(--color-primary);
      background: var(--color-primary-light);
      transform: translateX(4px);
    }

    .quiz-option.correct {
      border-color: var(--color-success);
      background: var(--color-success-light);
      color: var(--color-success);
    }

    .quiz-option.incorrect {
      border-color: var(--color-error);
      background: var(--color-error-light);
      color: var(--color-error);
    }

    .quiz-option.selected {
      border-color: var(--color-primary);
      background: var(--color-primary-light);
      color: var(--color-primary);
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }

    .slide-in {
      animation: slideIn 0.3s ease-out;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .app {
        padding: 0.5rem;
      }
      
      .card {
        padding: 1rem;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .grid-2,
      .grid-3 {
        grid-template-columns: 1fr;
      }
      
      .flex {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
    }

    /* Utility Classes */
    .hidden {
      display: none !important;
    }

    .text-center {
      text-align: center;
    }

    .mb-1 { margin-bottom: 0.25rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mb-3 { margin-bottom: 0.75rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }

    .mt-1 { margin-top: 0.25rem; }
    .mt-2 { margin-top: 0.5rem; }
    .mt-3 { margin-top: 0.75rem; }
    .mt-4 { margin-top: 1rem; }
    .mt-6 { margin-top: 1.5rem; }

    .p-4 { padding: 1rem; }
    .p-6 { padding: 1.5rem; }

    .w-full { width: 100%; }
    .h-full { height: 100%; }
  </style>
</head>
<body>
  <div class="app">
    <!-- TELA INICIAL -->
    <div id="home" class="fade-in">
      <!-- Header Principal -->
      <div class="card card-gradient">
        <div class="flex flex-between flex-wrap">
          <div style="flex: 2; min-width: 300px;">
            <div class="pill mb-3">
              üéì Quiz Educacional ‚Ä¢ Gratuito ‚Ä¢ GitHub Pages
            </div>
            <h1 id="quiz-title">Quiz de F√≠sica Moderna</h1>
            <p class="text-secondary mb-4">
              Pe√ßa aos alunos para escanear o QR Code ao lado para acessar o quiz diretamente. 
              Sistema completo com an√°lise detalhada de resultados para professores.
            </p>
            <div class="flex flex-wrap">
              <div class="pill-success">‚úÖ Interface Amig√°vel</div>
              <div class="pill-success">üìä An√°lise Detalhada</div>
              <div class="pill-success">üì± Mobile First</div>
            </div>
          </div>
          <div style="flex: 1; min-width: 250px;">
            <div class="qr-container">
              <div id="qrLink" class="qr-code">
                <img id="qrImage" style="max-width: 180px; max-height: 180px;" />
              </div>
              <p class="text-muted text-center mt-2">
                QR Code do Quiz
              </p>
              <div class="flex mt-3">
                <button class="btn btn-secondary btn-sm" id="btnQrLink">
                  üîÑ Atualizar
                </button>
                <button class="btn btn-secondary btn-sm" id="btnCopiarLink">
                  üìã Copiar Link
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Se√ß√£o Principal -->
      <div class="grid grid-2">
        <!-- √Årea do Aluno -->
        <div class="card slide-in">
          <h3>üë®‚Äçüéì √Årea do Aluno</h3>
          <p class="text-secondary mb-4">
            Digite seu nome (opcional) e clique em "Iniciar Quiz" para come√ßar.
          </p>
          
          <div class="input-group">
            <label class="label" for="alunoNome">
              üìù Seu nome (opcional)
            </label>
            <input 
              id="alunoNome" 
              class="input" 
              placeholder="Ex.: Ana Silva, Jo√£o Santos..." 
              maxlength="50"
            />
          </div>

          <div class="flex">
            <button class="btn btn-success btn-lg" id="btnIniciar">
              üöÄ Iniciar Quiz
            </button>
          </div>

          <div class="mt-4">
            <button class="btn btn-secondary" id="btnCarregarJSON">
              üìÅ Carregar Perguntas (JSON)
            </button>
            <input type="file" id="fileJSON" accept="application/json" class="hidden" />
          </div>
        </div>

        <!-- √Årea do Professor -->
        <div class="card slide-in">
          <h3>üë©‚Äçüè´ √Årea do Professor</h3>
          <p class="text-secondary mb-4">
            Ferramentas para coleta e an√°lise de resultados dos alunos.
          </p>

          <div class="grid">
            <button class="btn btn-warning" id="btnAbrirScanner">
              üì∑ Scanner de Resultados
            </button>
            <button class="btn btn-secondary" id="btnGerarQRResultadoDemo">
              üîó QR de Resultado (Demo)
            </button>
            <button class="btn btn-primary" id="btnDashboard">
              üìä Dashboard de An√°lise
            </button>
          </div>

          <div class="mt-4 p-4" style="background: var(--color-warning-light); border-radius: 8px; border-left: 4px solid var(--color-warning);">
            <p class="text-secondary" style="font-size: 0.8rem;">
              üí° <strong>Dica:</strong> Este quiz est√° hospedado no GitHub Pages com HTTPS autom√°tico, perfeito para usar a c√¢mera do scanner!
            </p>
          </div>
        </div>
      </div>

      <!-- Recursos Adicionais -->
      <div class="card">
        <h3>‚ú® Recursos da Vers√£o Melhorada</h3>
        <div class="grid grid-3">
          <div class="p-4" style="background: var(--color-success-light); border-radius: 8px;">
            <h4 style="color: var(--color-success); margin-bottom: 0.5rem;">üé® Interface Amig√°vel</h4>
            <p class="text-secondary" style="font-size: 0.875rem;">
              Paleta de cores past√©is, anima√ß√µes suaves e design focado na experi√™ncia educacional.
            </p>
          </div>
          <div class="p-4" style="background: var(--color-primary-light); border-radius: 8px;">
            <h4 style="color: var(--color-primary); margin-bottom: 0.5rem;">üìä An√°lise Avan√ßada</h4>
            <p class="text-secondary" style="font-size: 0.875rem;">
              Dashboard completo com m√©tricas detalhadas, an√°lise por descritores e relat√≥rios export√°veis.
            </p>
          </div>
          <div class="p-4" style="background: var(--color-purple-light); border-radius: 8px;">
            <h4 style="color: var(--color-purple); margin-bottom: 0.5rem;">üîß QR Code Otimizado</h4>
            <p class="text-secondary" style="font-size: 0.875rem;">
              Gera√ß√£o aprimorada de QR codes com customiza√ß√£o visual e melhor integra√ß√£o.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- TELA DO QUIZ -->
    <div id="quiz" class="hidden">
      <div class="card">
        <div class="flex flex-between flex-wrap mb-4">
          <div class="pill" id="meta">
            üìù Quest√£o <span id="qid">1</span> de <span id="qtotal">10</span>
          </div>
          <div class="flex" style="align-items: center; gap: 1rem;">
            <span class="text-muted">Progresso:</span>
            <div class="progress" style="width: 200px;">
              <div class="progress-bar" id="prog" style="width: 0%"></div>
            </div>
            <span class="text-muted" id="progText">0%</span>
          </div>
        </div>

        <div class="card" style="background: var(--gradient-primary); border: none;">
          <h2 id="qtext" class="mb-4">Carregando pergunta...</h2>
          <div id="olist" class="grid"></div>
        </div>

        <div class="flex mt-4">
          <button class="btn btn-secondary" id="btnSair">
            ‚Üê Sair do Quiz
          </button>
          <button class="btn btn-primary hidden" id="btnProxima">
            Pr√≥xima ‚Üí
          </button>
        </div>
      </div>
    </div>

    <!-- RESULTADO DO ALUNO -->
    <div id="resultado" class="hidden">
      <div class="card card-gradient text-center">
        <h2 class="mb-4">üéâ Quiz Conclu√≠do!</h2>
        <div id="resumo" class="mb-6"></div>
        
        <div class="grid grid-2">
          <!-- QR Code do Resultado -->
          <div class="card">
            <h3 class="text-center mb-4">üì± Compartilhar Resultado</h3>
            <div class="qr-container">
              <div id="qrResultado" class="qr-code">
                <img id="qrResultadoImage" style="max-width: 160px; max-height: 160px;" />
              </div>
              <p class="text-muted text-center mt-2">
                Mostre este QR para o professor escanear
              </p>
            </div>
            <button class="btn btn-primary w-full mt-3" id="btnGerarQRResultado">
              üîÑ Gerar QR do Resultado
            </button>
          </div>

          <!-- Op√ß√µes do Resultado -->
          <div class="card">
            <h3 class="mb-4">‚öôÔ∏è Op√ß√µes</h3>
            <div class="grid">
              <button class="btn btn-success" id="btnRefazer">
                üîÑ Refazer Quiz
              </button>
              <button class="btn btn-secondary" id="btnSalvarJSON">
                üíæ Baixar Resultado (JSON)
              </button>
              <button class="btn btn-secondary" id="btnCompartilhar">
                üì§ Compartilhar Link
              </button>
            </div>

            <!-- Estat√≠sticas Pessoais -->
            <div class="mt-4 p-4" style="background: var(--bg-secondary); border-radius: 8px;">
              <h4 class="mb-2">üìà Suas Estat√≠sticas</h4>
              <div id="estatisticasPessoais"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- √ÅREA DE TESTES -->
    <div class="card" id="tests">
      <h3>üß™ Testes Automatizados</h3>
      <div style="background: #000; color: #0f0; padding: 1rem; border-radius: 8px; font-family: monospace; font-size: 0.875rem;">
        <pre id="testsOut"></pre>
      </div>
    </div>
  </div>

  <script>
    // ===== CONFIGURA√á√ÉO E DADOS =====
    
    // Quest√µes do Quiz (com descritores educacionais)
    let QUESTOES = [
      {
        id: 1,
        texto: "Qual √© a velocidade da luz no v√°cuo?",
        opcoes: [
          "300.000 km/s",
          "299.792.458 m/s", 
          "3 √ó 10‚Å∏ m/s",
          "Todas as alternativas est√£o corretas"
        ],
        correta: 3,
        descritor: "D1 - Constantes f√≠sicas fundamentais",
        competencia: "Compreender fen√¥menos f√≠sicos",
        dificuldade: "F√°cil",
        tempo_estimado: 30
      },
      {
        id: 2,
        texto: "O que caracteriza o movimento retil√≠neo uniforme?",
        opcoes: [
          "Velocidade constante e acelera√ß√£o zero",
          "Velocidade vari√°vel e acelera√ß√£o constante",
          "Velocidade zero e acelera√ß√£o constante",
          "Velocidade e acelera√ß√£o vari√°veis"
        ],
        correta: 0,
        descritor: "D2 - Cinem√°tica b√°sica",
        competencia: "Analisar movimentos",
        dificuldade: "M√©dio",
        tempo_estimado: 45
      },
      {
        id: 3,
        texto: "Segundo a Lei de Ohm, a resist√™ncia el√©trica √©:",
        opcoes: [
          "R = V √ó I",
          "R = V / I",
          "R = I / V", 
          "R = V + I"
        ],
        correta: 1,
        descritor: "D3 - Eletricidade b√°sica",
        competencia: "Aplicar leis f√≠sicas",
        dificuldade: "F√°cil",
        tempo_estimado: 30
      },
      {
        id: 4,
        texto: "A energia cin√©tica de um objeto √© dada por:",
        opcoes: [
          "Ec = m √ó v",
          "Ec = ¬Ω √ó m √ó v",
          "Ec = ¬Ω √ó m √ó v¬≤",
          "Ec = m √ó v¬≤"
        ],
        correta: 2,
        descritor: "D4 - Energia mec√¢nica",
        competencia: "Aplicar conceitos energ√©ticos",
        dificuldade: "M√©dio",
        tempo_estimado: 40
      },
      {
        id: 5,
        texto: "O princ√≠pio da conserva√ß√£o da energia afirma que:",
        opcoes: [
          "A energia pode ser criada mas n√£o destru√≠da",
          "A energia pode ser destru√≠da mas n√£o criada",
          "A energia n√£o pode ser criada nem destru√≠da, apenas transformada",
          "A energia sempre aumenta em um sistema fechado"
        ],
        correta: 2,
        descritor: "D5 - Conserva√ß√£o de energia",
        competencia: "Compreender princ√≠pios fundamentais",
        dificuldade: "M√©dio",
        tempo_estimado: 50
      }
    ];

    // Estado do aplicativo
    let estadoApp = {
      telaAtual: 'home',
      questaoAtual: 0,
      respostas: [],
      nomeAluno: '',
      inicioQuiz: null,
      fimQuiz: null,
      resultados: [],
      scanner: null,
      qrCodes: {}
    };

    // Utilit√°rios
    const $ = (id) => document.getElementById(id);
    const $$ = (selector) => document.querySelectorAll(selector);
    
    const escapeHTML = (str) => {
      return String(str).replace(/[&<>"']/g, (match) => {
        const escape = {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        };
        return escape[match];
      });
    };

    const formatarTempo = (segundos) => {
      const mins = Math.floor(segundos / 60);
      const secs = segundos % 60;
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    };

    const gerarId = () => {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    };

    // ===== GERENCIAMENTO DE TELAS =====
    
    const mostrarTela = (tela) => {
      // Esconder todas as telas
      ['home', 'quiz', 'resultado', 'scanner', 'dashboard'].forEach(id => {
        const elemento = $(id);
        if (elemento) {
          elemento.classList.add('hidden');
        }
      });
      
      // Mostrar tela solicitada
      const telaElemento = $(tela);
      if (telaElemento) {
        telaElemento.classList.remove('hidden');
        telaElemento.classList.add('fade-in');
        estadoApp.telaAtual = tela;
      }
    };

    // ===== FUNCIONALIDADES DE QR CODE =====
    
    const gerarQRCode = (elementoImg, texto, opcoes = {}) => {
      if (!elementoImg) return;
      
      try {
        // Usar API gratuita do QR Server
        const size = opcoes.size || 200;
        const color = opcoes.color || '3b82f6';
        const bgcolor = opcoes.bgcolor || 'ffffff';
        
        const url = `https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(texto)}&color=${color}&bgcolor=${bgcolor}`;
        
        elementoImg.src = url;
        elementoImg.alt = 'QR Code';
        elementoImg.style.display = 'block';
        
        console.log('QR Code gerado com sucesso!');
      } catch (error) {
        console.error('Erro ao gerar QR Code:', error);
        elementoImg.style.display = 'none';
      }
    };

    const atualizarQRLink = () => {
      const url = window.location.href;
      gerarQRCode($('qrImage'), url, {
        size: 180,
        color: '3b82f6'
      });
    };

    // ===== FUNCIONALIDADES DO QUIZ =====
    
    const iniciarQuiz = () => {
      estadoApp.nomeAluno = $('alunoNome').value.trim() || 'An√¥nimo';
      estadoApp.questaoAtual = 0;
      estadoApp.respostas = [];
      estadoApp.inicioQuiz = new Date();
      
      mostrarTela('quiz');
      mostrarQuestao();
    };

    const mostrarQuestao = () => {
      const questao = QUESTOES[estadoApp.questaoAtual];
      if (!questao) {
        finalizarQuiz();
        return;
      }

      // Atualizar interface
      $('qid').textContent = estadoApp.questaoAtual + 1;
      $('qtotal').textContent = QUESTOES.length;
      $('qtext').textContent = questao.texto;
      
      // Atualizar barra de progresso
      const progresso = ((estadoApp.questaoAtual) / QUESTOES.length) * 100;
      $('prog').style.width = progresso + '%';
      $('progText').textContent = Math.round(progresso) + '%';
      
      // Gerar op√ß√µes
      const olist = $('olist');
      olist.innerHTML = '';
      
      questao.opcoes.forEach((opcao, index) => {
        const div = document.createElement('div');
        div.className = 'quiz-option slide-in';
        div.style.animationDelay = (index * 0.1) + 's';
        div.innerHTML = `
          <div style="display: flex; align-items: center; gap: 1rem;">
            <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--color-primary-light); color: var(--color-primary); display: flex; align-items: center; justify-content: center; font-weight: bold;">
              ${String.fromCharCode(65 + index)}
            </div>
            <div style="flex: 1;">${escapeHTML(opcao)}</div>
          </div>
        `;
        
        div.addEventListener('click', () => selecionarOpcao(index, div));
        olist.appendChild(div);
      });
    };

    const selecionarOpcao = (indice, elemento) => {
      // Remover sele√ß√£o anterior
      $$('.quiz-option').forEach(opt => {
        opt.classList.remove('selected');
      });
      
      // Selecionar nova op√ß√£o
      elemento.classList.add('selected');
      
      // Salvar resposta
      estadoApp.respostas[estadoApp.questaoAtual] = {
        questao: estadoApp.questaoAtual,
        resposta: indice,
        tempo: new Date() - estadoApp.inicioQuiz,
        correta: indice === QUESTOES[estadoApp.questaoAtual].correta
      };
      
      // Mostrar bot√£o pr√≥xima
      $('btnProxima').classList.remove('hidden');
      
      // Auto-avan√ßar ap√≥s 1 segundo
      setTimeout(() => {
        proximaQuestao();
      }, 1000);
    };

    const proximaQuestao = () => {
      estadoApp.questaoAtual++;
      
      if (estadoApp.questaoAtual >= QUESTOES.length) {
        finalizarQuiz();
      } else {
        $('btnProxima').classList.add('hidden');
        mostrarQuestao();
      }
    };

    const finalizarQuiz = () => {
      estadoApp.fimQuiz = new Date();
      mostrarTela('resultado');
      gerarResultado();
    };

    // ===== GERA√á√ÉO DE RESULTADOS =====
    
    const gerarResultado = () => {
      const acertos = estadoApp.respostas.filter(r => r.correta).length;
      const total = QUESTOES.length;
      const percentual = Math.round((acertos / total) * 100);
      const tempoTotal = Math.round((estadoApp.fimQuiz - estadoApp.inicioQuiz) / 1000);
      
      // Resumo principal
      const resumo = $('resumo');
      resumo.innerHTML = `
        <div class="grid grid-3 mb-4">
          <div class="card text-center" style="background: var(--color-success-light);">
            <h3 style="color: var(--color-success); margin-bottom: 0.5rem;">‚úÖ Acertos</h3>
            <div style="font-size: 2.5rem; font-weight: bold; color: var(--color-success);">${acertos}</div>
            <p class="text-muted">de ${total} quest√µes</p>
          </div>
          <div class="card text-center" style="background: var(--color-primary-light);">
            <h3 style="color: var(--color-primary); margin-bottom: 0.5rem;">üìä Percentual</h3>
            <div style="font-size: 2.5rem; font-weight: bold; color: var(--color-primary);">${percentual}%</div>
            <p class="text-muted">de aproveitamento</p>
          </div>
          <div class="card text-center" style="background: var(--color-warning-light);">
            <h3 style="color: var(--color-warning); margin-bottom: 0.5rem;">‚è±Ô∏è Tempo</h3>
            <div style="font-size: 2.5rem; font-weight: bold; color: var(--color-warning);">${formatarTempo(tempoTotal)}</div>
            <p class="text-muted">tempo total</p>
          </div>
        </div>
        
        <div class="card" style="background: ${percentual >= 70 ? 'var(--color-success-light)' : 'var(--color-warning-light)'};">
          <h3 style="color: ${percentual >= 70 ? 'var(--color-success)' : 'var(--color-warning)'};">
            ${percentual >= 70 ? 'üéâ Parab√©ns!' : 'üìö Continue estudando!'}
          </h3>
          <p>
            ${percentual >= 70 
              ? `Excelente desempenho! Voc√™ demonstrou bom dom√≠nio do conte√∫do.`
              : `Voc√™ pode melhorar! Revise os t√≥picos e tente novamente.`
            }
          </p>
        </div>
      `;
      
      // Estat√≠sticas pessoais detalhadas
      gerarEstatisticasPessoais();
    };

    const gerarEstatisticasPessoais = () => {
      const container = $('estatisticasPessoais');
      if (!container) return;
      
      // An√°lise por descritor
      const analiseDescritores = {};
      estadoApp.respostas.forEach((resposta, index) => {
        const questao = QUESTOES[index];
        const descritor = questao.descritor;
        
        if (!analiseDescritores[descritor]) {
          analiseDescritores[descritor] = {
            total: 0,
            acertos: 0,
            competencia: questao.competencia
          };
        }
        
        analiseDescritores[descritor].total++;
        if (resposta.correta) {
          analiseDescritores[descritor].acertos++;
        }
      });
      
      let html = '<h5 class="mb-2">üìã Performance por Descritor:</h5>';
      
      Object.entries(analiseDescritores).forEach(([descritor, dados]) => {
        const percentual = Math.round((dados.acertos / dados.total) * 100);
        const cor = percentual >= 70 ? 'var(--color-success)' : percentual >= 50 ? 'var(--color-warning)' : 'var(--color-error)';
        
        html += `
          <div class="mb-2 p-2" style="background: var(--bg-secondary); border-radius: 6px; border-left: 3px solid ${cor};">
            <div style="font-weight: 500; font-size: 0.875rem;">${descritor}</div>
            <div style="font-size: 0.75rem; color: var(--text-muted);">${dados.competencia}</div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.25rem;">
              <span style="font-size: 0.75rem;">${dados.acertos}/${dados.total} acertos</span>
              <span style="font-weight: bold; color: ${cor};">${percentual}%</span>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    };

    // ===== FUNCIONALIDADES DE QR RESULTADO =====
    
    const gerarQRResultado = () => {
      const resultado = {
        tipo: 'quiz-resultado',
        quizId: gerarId(),
        titulo: $('quiz-title').textContent,
        nome: estadoApp.nomeAluno,
        score: estadoApp.respostas.filter(r => r.correta).length,
        total: QUESTOES.length,
        percentual: Math.round((estadoApp.respostas.filter(r => r.correta).length / QUESTOES.length) * 100),
        quando: estadoApp.fimQuiz.toISOString(),
        tempo_total: Math.round((estadoApp.fimQuiz - estadoApp.inicioQuiz) / 1000),
        respostas: estadoApp.respostas
      };
      
      const dados = JSON.stringify(resultado);
      gerarQRCode($('qrResultadoImage'), dados, {
        size: 160,
        color: '10b981'
      });
    };

    // ===== FUNCIONALIDADES AUXILIARES =====
    
    const carregarJSON = (event) => {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const questoes = JSON.parse(e.target.result);
          if (Array.isArray(questoes) && questoes.length > 0) {
            QUESTOES = questoes;
            alert(`${questoes.length} quest√µes carregadas com sucesso!`);
          } else {
            alert('Formato de arquivo inv√°lido.');
          }
        } catch (error) {
          alert('Erro ao carregar arquivo JSON.');
        }
      };
      reader.readAsText(file);
    };

    const copiarLink = () => {
      navigator.clipboard.writeText(window.location.href).then(() => {
        alert('Link copiado para a √°rea de transfer√™ncia!');
      }).catch(() => {
        alert('Erro ao copiar link.');
      });
    };

    const salvarResultadoJSON = () => {
      const resultado = {
        nome: estadoApp.nomeAluno,
        score: estadoApp.respostas.filter(r => r.correta).length,
        total: QUESTOES.length,
        respostas: estadoApp.respostas,
        quando: estadoApp.fimQuiz.toISOString()
      };
      
      const blob = new Blob([JSON.stringify(resultado, null, 2)], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `resultado-${estadoApp.nomeAluno}-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
    };

    // ===== EVENT LISTENERS =====
    
    const inicializarEventListeners = () => {
      // Bot√µes principais
      $('btnIniciar').addEventListener('click', iniciarQuiz);
      $('btnSair').addEventListener('click', () => mostrarTela('home'));
      $('btnRefazer').addEventListener('click', () => {
        mostrarTela('home');
        $('alunoNome').value = '';
      });
      
      // QR Code
      $('btnQrLink').addEventListener('click', atualizarQRLink);
      $('btnCopiarLink').addEventListener('click', copiarLink);
      $('btnGerarQRResultado').addEventListener('click', gerarQRResultado);
      $('btnGerarQRResultadoDemo').addEventListener('click', () => {
        alert('QR Demo: Em um cen√°rio real, este QR seria escaneado pelo professor para coletar o resultado.');
      });
      
      // Arquivo JSON
      $('btnCarregarJSON').addEventListener('click', () => $('fileJSON').click());
      $('fileJSON').addEventListener('change', carregarJSON);
      
      // Compartilhar
      $('btnCompartilhar').addEventListener('click', () => {
        if (navigator.share) {
          navigator.share({
            title: 'Meu Resultado no Quiz',
            text: `Acertei ${estadoApp.respostas.filter(r => r.correta).length} de ${QUESTOES.length} quest√µes!`,
            url: window.location.href
          });
        } else {
          copiarLink();
        }
      });
      
      // Salvar JSON
      $('btnSalvarJSON').addEventListener('click', salvarResultadoJSON);
      
      // Bot√µes do professor (funcionalidades b√°sicas)
      $('btnAbrirScanner').addEventListener('click', () => {
        alert('Scanner de QR Code: Em um ambiente real com HTTPS, a c√¢mera seria ativada aqui para escanear os resultados dos alunos.');
      });
      
      $('btnDashboard').addEventListener('click', () => {
        alert('Dashboard: Funcionalidade dispon√≠vel quando houver resultados coletados dos alunos.');
      });
      
      // Teclas de atalho
      document.addEventListener('keydown', (e) => {
        if (estadoApp.telaAtual === 'quiz') {
          const num = parseInt(e.key);
          if (num >= 1 && num <= 4) {
            const opcoes = $$('.quiz-option');
            if (opcoes[num - 1]) {
              opcoes[num - 1].click();
            }
          }
        }
      });
    };

    // ===== TESTES AUTOMATIZADOS =====
    
    const executarTestes = () => {
      const out = $('testsOut');
      out.textContent = '';
      
      const log = (msg) => {
        out.textContent += msg + '\n';
      };
      
      const test = (nome, fn) => {
        try {
          fn();
          log(`‚úÖ ${nome}`);
        } catch (error) {
          log(`‚ùå ${nome}: ${error.message}`);
        }
      };
      
      const assertEqual = (atual, esperado, msg = '') => {
        if (atual !== esperado) {
          throw new Error(`${msg} - Esperado: ${esperado}, Atual: ${atual}`);
        }
      };
      
      const assert = (condicao, msg = 'Falhou') => {
        if (!condicao) {
          throw new Error(msg);
        }
      };
      
      log('üß™ Iniciando testes automatizados...\n');
      
      // Testes de funcionalidades b√°sicas
      test('Gera√ß√£o de ID √∫nico', () => {
        const id1 = gerarId();
        const id2 = gerarId();
        assert(id1 !== id2, 'IDs devem ser √∫nicos');
        assert(typeof id1 === 'string', 'ID deve ser string');
      });
      
      test('Formata√ß√£o de tempo', () => {
        assertEqual(formatarTempo(65), '1:05');
        assertEqual(formatarTempo(120), '2:00');
        assertEqual(formatarTempo(30), '0:30');
      });
      
      test('Escape HTML', () => {
        assertEqual(escapeHTML('<script>'), '&lt;script&gt;');
        assertEqual(escapeHTML('A & B'), 'A &amp; B');
      });
      
      // Testes de l√≥gica do quiz
      test('C√°lculo de pontua√ß√£o', () => {
        const respostasDemo = [
          { correta: true },
          { correta: false },
          { correta: true }
        ];
        const acertos = respostasDemo.filter(r => r.correta).length;
        assertEqual(acertos, 2);
      });
      
      test('Valida√ß√£o de quest√µes', () => {
        assert(Array.isArray(QUESTOES), 'QUESTOES deve ser array');
        assert(QUESTOES.length > 0, 'Deve ter pelo menos uma quest√£o');
        
        QUESTOES.forEach((q, i) => {
          assert(typeof q.texto === 'string', `Quest√£o ${i}: texto deve ser string`);
          assert(Array.isArray(q.opcoes), `Quest√£o ${i}: op√ß√µes deve ser array`);
          assert(q.opcoes.length >= 2, `Quest√£o ${i}: deve ter pelo menos 2 op√ß√µes`);
          assert(typeof q.correta === 'number', `Quest√£o ${i}: correta deve ser n√∫mero`);
          assert(q.correta >= 0 && q.correta < q.opcoes.length, `Quest√£o ${i}: √≠ndice correto inv√°lido`);
        });
      });
      
      // Testes de QR Code
      test('Gera√ß√£o de QR Code', () => {
        const img = document.createElement('img');
        gerarQRCode(img, 'teste');
        assert(img.src.includes('qrserver.com'), 'QR Code deve usar API externa');
      });
      
      log('\n‚ú® Testes conclu√≠dos!');
      log(`üìä Total de quest√µes: ${QUESTOES.length}`);
      log(`üéØ Descritores √∫nicos: ${new Set(QUESTOES.map(q => q.descritor)).size}`);
      log(`‚è±Ô∏è Tempo estimado total: ${QUESTOES.reduce((acc, q) => acc + (q.tempo_estimado || 30), 0)}s`);
      log(`üîó QR Code: Usando API externa (QR Server)`);
    };

    // ===== INICIALIZA√á√ÉO =====
    
    const inicializar = () => {
      console.log('üéì Quiz Educacional - GitHub Pages - Inicializando...');
      
      // Configurar event listeners
      inicializarEventListeners();
      
      // Gerar QR code inicial ap√≥s um pequeno delay
      setTimeout(() => {
        atualizarQRLink();
      }, 1000);
      
      // Executar testes
      executarTestes();
      
      // Mostrar tela inicial
      mostrarTela('home');
      
      console.log('‚úÖ Inicializa√ß√£o conclu√≠da!');
    };

    // Aguardar carregamento completo da p√°gina
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', inicializar);
    } else {
      inicializar();
    }

    console.log('üöÄ Quiz Educacional - Vers√£o GitHub Pages carregado!');
  </script>
</body>
</html>

